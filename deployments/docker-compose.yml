version: '3'
services:
  apigateway:
    image: apigateway:1.0.0
    container_name: apigateway
    ports:
      - 8080:8080
    environment:
      LOG_LEVEL: debug
      CONSUL_ADDR: 172.16.7.120:8500
    depends_on:
      - consul
      - userservice
  userservice:
    image: userservice:1.0.0
    container_name: userservice
    ports:
      - 5000:5000
    environment:
      CONFIG_FILE: configs/dev.toml
      LOG_LEVEL: debug
    depends_on:
      - redis
      - consul
    #command: ['sleep', '200000']
    volumes:
      - ./configs/userservice/:/data/configs
  swagger:
    image: swaggerapi/swagger-ui:v3.22.1
    container_name: swagger
    ports:
      - 8088:8080
  redis:
    image: redis:5.0.4
    container_name: redis
    ports:
      - 6379:6379
  consul:
    image: consul:1.4.4
    container_name: consul
    ports:
      - 8500:8500
      - 8600:8600
    command: "agent -server -client 0.0.0.0 -bootstrap-expect=1"
  nginx:
    image: nginx:1.16
    container_name: nginx
    ports:
      - 80:80
    environment:
      - NGINX_PORT=80
    volumes:
      - ./nginx/conf/:/etc/nginx/
      - ./app/:/app/
